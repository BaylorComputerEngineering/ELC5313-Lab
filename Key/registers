module registers(
   input logic clock, issue,  
   input logic [4:0] A_address,B_address, dest,    
   input logic [31:0] In_data,
   input logic [5:0] In_source, RS_calculating_value,
   input logic write,
   output logic [31:0] A_out, B_out,
   output logic A_invalid,B_invalid
   );
   
   parameter not_redirected=0;
   parameter true=1'b1;
   parameter false=1'b0;
   parameter num_of_regs=32;
   
   logic [31:0] reg_file [31:0];
   
   logic [5:0] redirection [31:0];
   
   integer i;
   
   initial
     begin
       for(i=0;i<num_of_regs;i=i+1)
         begin
             reg_file[i]=i;
             redirection[i]=not_redirected;
         end
     end 
   

   always@(negedge clock)
   begin
       if (issue)
       begin
          if (redirection[A_address]==not_redirected)
             begin
                 A_out<=reg_file[A_address];
                 A_invalid<=false;
             end
		  else
             begin
                A_out<=redirection[A_address];
                A_invalid<=true;
             end 
          if (redirection[B_address]==not_redirected)
             begin
				 B_out<=reg_file[B_address];
                 B_invalid<=false;
             end
          else
             begin
                B_out<=redirection[B_address];
                B_invalid<=true;
             end 
          redirection[dest]<=RS_calculating_value;
       end 
   end
         
       
    always@(posedge clock)
       begin 
		  for(i=0;i<num_of_regs;i=i+1)
          begin 
             if ((write==1)&&(In_source==redirection[i]))
             begin
				   reg_file[i]<=In_data;
                   redirection[i]<=not_redirected;
             end 
          end
       end
endmodule
